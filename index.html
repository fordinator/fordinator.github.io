<!DOCTYPE html>
<html>
  <head>
      <meta charset="UTF-8">
      <title>MP's Students</title>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.1.2/handlebars.min.js"></script>
  </head>

  <body>
	  <h2>Choose Students by Major</h2>
		<input type='button' id='btnCIT' value='CIT Majors'>
		<input type='button' id='btnBUS' value='BUS Majors'>
	  <h3>We filter our dataset by major</h3>
          <div id="studentsTable"></div>
  </body>

  <script type="text/x-handlebars-template" id="tableTemplate">
    <table cellspacing='6'>
       <tr><th>Name</th><th>Name</th><th>Major</th><th>Midterm</th><th>Final</th></tr>
       {{#each rows}}
            <tr>
                <td>{{name}}</td><td>{{major}}</td><td>{{midterm}}</td><td>{{final}}</td>
            </tr>
       {{/each}}
    </table>
  </script>
  
  <script> 
  
	document.querySelector('#btnCIT').onclick = function() {
		getStudents("CIT");
	}
	document.querySelector('#btnBUS').onclick = function() {
		getStudents("BUS");
	}

	async function getStudents(choice) {
        var url = "https://raw.githubusercontent.com/fordinator/fordinator.github.io/main/cit5students.json";    
        var response = await fetch(url);
        if (response.ok) {

            var data = await response.json();
			var filteredData = [];
			
			for (i = 0; i < data.length; i++) {
				if (data[i].major == choice) {
				    filteredData.push(data[i]);
				}
			}
		
            var templateText = document.getElementById('tableTemplate').innerHTML; 
            var compiledTemplateText = Handlebars.compile(templateText);   
            compiledHtml = compiledTemplateText({ rows: filteredData })             
			document.querySelector('#studentsTable').innerHTML = compiledHtml; 	
        }
        else {
            document.querySelector('#studentsTable').innerHTML = "Data not found";
        }
    }
  
</script>
</html>